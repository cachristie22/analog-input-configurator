<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IoT Channel Config Editor</title>
  <style>
    table {
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 4px;
      text-align: left;
    }
    input {
      width: 100%;
      box-sizing: border-box;
    }
    textarea {
      width: 100%;
      height: 200px;
      margin-top: 10px;
    }
    .container {
      overflow-x: scroll;
    }
  </style>
</head>
<body>
  <h1>IoT Channel Configuration Editor</h1>
  <div class="container">
    <table id="configTable">
      <thead>
        <tr id="headerRow"></tr>
      </thead>
      <tbody id="configBody"></tbody>
    </table>
  </div>
  <button onclick="exportConfig()">Export to Textarea</button>
  <button onclick="downloadConfig()">Download .log File</button>
  <input type="file" id="fileInput" accept=".log" onchange="importConfig(event)" />
  <textarea id="output"></textarea>

  <script>
    const paramMap = {
      1: 'name', 2: 'enable', 3: 'type', 4: 'report', 5: 'srcreg', 6: 'scroll', 7: 'delta', 8: 'deltadeb', 9: 'pump',
      20: 'prec', 21: 'units', 30: 'bitnum', 31: 'zerolabel', 32: 'onelabel', 98: 'id'
    };

    const configLines = `9,1,1,Power,2,1,3,2,4,1,5,106,6,1,7,0.5,8,5,9,0,20,1,21,v,98,1001
9,2,1,Cell Fault,2,1,3,1,4,1,5,1,6,1,7,0.0,8,5,9,0,30,0,31,Off,32,On,98,1002
9,3,1,Comm1 Fault,2,1,3,1,4,1,5,2,6,1,7,0.0,8,5,9,0,30,0,31,Off,32,On,98,1003
9,4,1,Comm2 Fault,2,1,3,1,4,1,5,3,6,1,7,0.0,8,5,9,0,30,0,31,Off,32,On,98,1004
9,5,1,BLE Fault,2,1,3,1,4,1,5,4,6,1,7,0.0,8,5,9,0,30,0,31,Off,32,On,98,1005
9,6,1,Ethernet Fault,2,1,3,1,4,1,5,5,6,1,7,0.0,8,5,9,0,30,0,31,Off,32,On,98,1006
9,7,1,Display Fault,2,1,3,1,4,1,5,6,6,1,7,0.0,8,5,9,0,30,0,31,Off,32,On,98,1007
9,8,1,PCB Temperature,2,1,3,2,4,1,5,107,6,1,7,5.0,8,5,9,0,20,1,21,degF,98,1008
9,9,1,User Chan 9,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1009
9,10,1,Dufus,2,0,3,0,4,1,5,0,6,0,7,0.33,8,5,9,88,98,1010
9,11,1,User Chan 11,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1011
9,12,1,User Chan 12,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1012
9,13,1,User Chan 13,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1013
9,14,1,User Chan 14,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1014
9,15,1,User Chan 15,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1015
9,16,1,User Chan 16,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1016
9,17,1,User Chan 17,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1017
9,18,1,User Chan 18,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1018
9,19,1,User Chan 19,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1019
9,20,1,User Chan 20,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1020
9,21,1,Pump 1 Running,2,1,3,1,4,1,5,201,6,2,7,0.5,8,5,9,0,30,0,31,Stopped,32,Running,98,1021
9,22,1,Digital Input 2,2,1,3,1,4,1,5,202,6,2,7,0.5,8,5,9,0,30,0,31,Off,32,On,98,1022
9,23,1,Digital Input 3,2,1,3,1,4,1,5,203,6,2,7,0.5,8,5,9,0,30,0,31,Off,32,On,98,1023
9,24,1,Digital Input 4,2,1,3,1,4,1,5,204,6,2,7,0.5,8,5,9,0,30,0,31,Off,32,On,98,1024
9,25,1,Digital Input 5,2,1,3,1,4,1,5,205,6,2,7,0.5,8,5,9,0,30,0,31,Off,32,On,98,1025
9,26,1,Digital Input 6,2,1,3,1,4,1,5,206,6,2,7,0.5,8,5,9,0,30,0,31,Off,32,On,98,1026
9,27,1,Digital Input 7,2,1,3,1,4,1,5,207,6,2,7,0.5,8,5,9,0,30,0,31,Off,32,On,98,1027
9,28,1,Digital Input 8,2,1,3,1,4,1,5,208,6,2,7,0.5,8,5,9,0,30,0,31,Off,32,On,98,1028
9,29,1,Digital Input 9,2,1,3,1,4,1,5,209,6,3,7,0.5,8,5,9,0,30,0,31,Off,32,On,98,1029
9,30,1,Digital Input 10,2,1,3,1,4,1,5,210,6,3,7,0.5,8,5,9,0,30,0,31,Off,32,On,98,1030
9,31,1,User Chan 31,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1031
9,32,1,User Chan 32,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1032
9,33,1,User Chan 33,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1033
9,34,1,User Chan 34,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1034
9,35,1,User Chan 35,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1035
9,36,1,User Chan 36,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1036
9,37,1,User Chan 37,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1037
9,38,1,User Chan 38,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1038
9,39,1,User Chan 39,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1039
9,40,1,User Chan 40,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1040
9,41,1,Pulse Input 1,2,1,3,2,4,1,5,251,6,3,7,500.0,8,5,9,0,20,0,21,cnt,98,1041
9,42,1,Pulse Input 2,2,1,3,2,4,1,5,252,6,3,7,500.0,8,5,9,0,20,0,21,cnt,98,1042
9,43,1,AC Freq (Hz),2,1,3,2,4,1,5,263,6,5,7,500.0,8,5,9,0,20,1,21,hz,98,1043
9,44,1,User Chan 44,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1044
9,45,1,User Chan 45,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1045
9,46,1,User Chan 46,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1046
9,47,1,User Chan 47,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1047
9,48,1,User Chan 48,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1048
9,49,1,User Chan 49,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1049
9,50,1,User Chan 50,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1050
9,51,1,Analog Input 1,2,1,3,2,4,1,5,101,6,4,7,1.0,8,5,9,0,20,1,21,units,98,1051
9,52,1,Analog Input 2,2,1,3,2,4,1,5,102,6,4,7,1.0,8,5,9,0,20,1,21,units,98,1052
9,53,1,Analog Input 3,2,1,3,2,4,1,5,103,6,4,7,1.0,8,5,9,0,20,1,21,units,98,1053
9,54,1,Analog Input 4,2,1,3,2,4,1,5,104,6,4,7,1.0,8,5,9,0,20,1,21,units,98,1054
9,55,1,Analog Input 5,2,1,3,2,4,1,5,105,6,4,7,1.0,8,5,9,0,20,1,21,units,98,1055
9,56,1,AC-VoltA,2,1,3,2,4,1,5,108,6,5,7,1.0,8,5,9,0,20,1,21,v,98,1056
9,57,1,AC-VoltB,2,1,3,2,4,1,5,109,6,5,7,1.0,8,5,9,0,20,1,21,v,98,1057
9,58,1,AC-VoltC,2,1,3,2,4,1,5,110,6,5,7,1.0,8,5,9,0,20,1,21,v,98,1058
9,59,1,AC-CurrA,2,1,3,2,4,1,5,111,6,5,7,1.0,8,5,9,0,20,1,21,amp,98,1059
9,60,1,AC-CurrB,2,1,3,2,4,1,5,112,6,5,7,1.0,8,5,9,0,20,1,21,amp,98,1060
9,61,1,AC-CurrC,2,1,3,2,4,1,5,113,6,5,7,1.0,8,5,9,0,20,1,21,amp,98,1061
9,62,1,User Chan 62,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1062
9,63,1,User Chan 63,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1063
9,64,1,User Chan 64,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1064
9,65,1,Analog Output 1,2,1,3,2,4,1,5,151,6,4,7,1.0,8,0,9,0,20,1,21,units,98,1065
9,66,1,Analog Output 2,2,1,3,2,4,1,5,152,6,4,7,1.0,8,0,9,0,20,1,21,units,98,1066
9,67,1,User Chan 67,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1067
9,68,1,User Chan 68,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1068
9,69,1,User Chan 69,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1069
9,70,1,User Chan 70,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1070
9,71,1,Digital Output 1,2,1,3,1,4,1,5,301,6,6,7,0.5,8,0,9,0,30,0,31,Off,32,On,98,1071
9,72,1,Digital Output 2,2,1,3,1,4,1,5,302,6,6,7,0.5,8,0,9,0,30,0,31,Off,32,On,98,1072
9,73,1,Digital Output 3,2,1,3,1,4,1,5,303,6,6,7,0.5,8,0,9,0,30,0,31,Off,32,On,98,1073
9,74,1,Digital Output 4,2,1,3,1,4,1,5,304,6,6,7,0.5,8,0,9,0,30,0,31,Off,32,On,98,1074
9,75,1,Digital Output 5,2,1,3,1,4,1,5,305,6,6,7,0.5,8,0,9,0,30,0,31,Off,32,On,98,1075
9,76,1,Digital Output 6,2,1,3,1,4,0,5,306,6,6,7,0.5,8,0,9,0,30,0,31,Off,32,On,98,1076
9,77,1,User Chan 77,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1077
9,78,1,User Chan 78,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1078
9,79,1,User Chan 79,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1079
9,80,1,User Chan 80,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1080
9,81,1,User Chan 81,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1081
9,82,1,User Chan 82,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1082
9,83,1,User Chan 83,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1083
9,84,1,User Chan 84,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1084
9,85,1,User Chan 85,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1085
9,86,1,User Chan 86,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1086
9,87,1,User Chan 87,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1087
9,88,1,User Chan 88,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1088
9,89,1,User Chan 89,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1089
9,90,1,User Chan 90,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1090
9,91,1,User Chan 91,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1091
9,92,1,User Chan 92,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1092
9,93,1,User Chan 93,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1093
9,94,1,User Chan 94,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1094
9,95,1,User Chan 95,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1095
9,96,1,User Chan 96,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1096
9,97,1,User Chan 97,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1097
9,98,1,User Chan 98,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1098
9,99,1,User Chan 99,2,0,3,0,4,1,5,0,6,0,7,0.5,8,5,9,0,98,1099
9,100,1,StorageTankReceive,2,1,3,2,4,1,5,1500,6,0,7,0.5,8,0,9,1,20,1,21,ft,98,1100
` // Insert your full config data as a string here (copy all lines starting with "9,")
      .trim().split('\n');

    const allParams = Array.from(new Set(Object.values(paramMap)));

    const headerRow = document.getElementById('headerRow');
    headerRow.innerHTML = '<th>Channel</th>' + allParams.map(p => `<th>${p}</th>`).join('');

    const configBody = document.getElementById('configBody');

    function renderRow(chanNum, paramEntries) {
      const row = document.createElement('tr');
      const values = { channel: chanNum };
      for (let i = 0; i < paramEntries.length; i += 2) {
        const key = paramMap[paramEntries[i]];
        if (key) values[key] = paramEntries[i + 1];
      }
      row.innerHTML = `<td>${chanNum}</td>` + allParams.map(p =>
        `<td><input type="text" data-chan="${chanNum}" data-param="${p}" value="${values[p] || ''}" /></td>`
      ).join('');
      configBody.appendChild(row);
    }

    configLines.forEach(line => {
      const parts = line.split(',');
      if (parts[0] !== '9') return;
      const chanNum = parts[1];
      const paramEntries = parts.slice(2);
      renderRow(chanNum, paramEntries);
    });

    function exportConfig() {
      const rows = document.querySelectorAll('#configBody tr');
      let output = '';
      rows.forEach(row => {
        const chan = row.querySelector('td').innerText;
        const inputs = row.querySelectorAll('input');
        const entries = Array.from(inputs).map(input => {
          const paramNum = Object.entries(paramMap).find(([k, v]) => v === input.dataset.param)[0];
          return `${paramNum},${input.value}`;
        });
        output += `9,${chan},${entries.join(',')}\n`;
      });
      document.getElementById('output').value = output.trim();
    }

    function downloadConfig() {
      exportConfig();
      const blob = new Blob([document.getElementById('output').value], { type: 'text/plain' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'config.log';
      link.click();
    }

    function importConfig(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(e) {
        const lines = e.target.result.split(/\r?\n/);
        configBody.innerHTML = '';
        lines.forEach(line => {
          line = line.trim();
          if (!line || line.startsWith('//')) return; // Skip blank and comment lines
          const parts = line.split(',');
          if (parts[0] !== '9') return;
          const chanNum = parts[1];
          const paramEntries = parts.slice(2);
          renderRow(chanNum, paramEntries);
        });
      };
      reader.readAsText(file);
    }
  </script>
</body>
</html>
